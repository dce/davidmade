require 'mustache'
require 'yaml'
require 'rdiscount'

Dir.glob('lib/*.rb').each {|f| require f }

task :build do |t|
  print "Rebuilding... "

  FileUtils.rm_rf("public/posts")
  FileUtils.mkdir("public/posts")

  layout = Layout.new do
    Index.new(Post.all).render
  end

  File.open("public/index.html", "w") do |index|
    index.write layout.render
  end

  File.open("public/index.atom", "w") do |feed|
    feed.write Index.new(Post.all, :format => :atom).render
  end

  puts "done."
end

task :new_post, [:file_name] do |t, args|
  File.open("posts/#{args.file_name}.md", "w") do |file|
    file.write "title:\n"
    file.write "date: #{Date.today}"
  end

  exec "mate posts/#{args.file_name}.md"
end

task :server do |t|
 sh "cd ./public && python -m SimpleHTTPServer"
end